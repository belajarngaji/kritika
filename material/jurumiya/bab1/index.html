<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Jurumiya - Bab 1 | Kritika</title>
  <!-- CSS Global -->
  <link rel="stylesheet" href="/kritika/assets/css/style.css">
  <!-- Font Modern -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- HEADER / NAVBAR -->
  <header>
    <nav class="navbar">
      <h1 class="logo">Kritika</h1>
      <ul class="nav-links">
        <li><a href="/kritika/index.html">Beranda</a></li>
        <li><a href="/kritika/material/index.html" class="active">Materi</a></li>
        <li><a href="/kritika/question/index.html">Pertanyaan</a></li>
        <li><a href="/kritika/reflection/index.html">Refleksi</a></li>
      </ul>
    </nav>
  </header>

  <!-- MAIN CONTENT -->
  <main class="content">
    <section class="section-header">
      <h2>Jurumiya - Bab 1</h2>
      <p>Pengenalan awal Jurumiya untuk memahami dasar-dasar.</p>
    </section>

    <!-- MATERI -->
    <article class="lesson" id="materiContent">
      <p>Loading materi...</p>
    </article>

    <!-- TOMBOL AI -->
    <div class="ai-actions">
      <button id="btnGenerate" class="btn">Generate Pertanyaan Kritis</button>
    </div>

    <!-- HASIL AI -->
    <div id="aiOutput" class="ai-output"></div>

    <!-- NAVIGASI BAB -->
    <div class="lesson-nav">
      <a href="/kritika/material/jurumiya/index.html" class="btn-outline">← Kembali ke Daftar Bab</a>
      <a href="/kritika/material/jurumiya/bab2/index.html" class="btn">Lanjut ke Bab 2 →</a>
    </div>
  </main>

  <!-- FOOTER -->
  <footer>
    <p>© 2025 Kritika | Belajar Kritis</p>
  </footer>

  <!-- JS LANGSUNG DI FILE -->
  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // ===============================
    // CONFIG SUPABASE
    // ===============================
    const SUPABASE_URL = 'https://jpxtbdawajjyrvqrgijd.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpweHRiZGF3YWpqeXJ2cXJnaWpkIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTYzMTI4OTgsImV4cCI6MjA3MTg4ODg5OH0.vEqCzHYBByFZEXeLIBqx6b40x6-tjSYa3Il_b2mI9NE'; // isi dengan anon key kamu
    const supabase = createClient(SUPABASE_URL, SUPABASE_KEY);

    // ===============================
    // FETCH MATERIALS
    // ===============================
    async function getMaterials() {
      const { data, error } = await supabase.from('materials').select('*').order('id');
      return error ? [] : data;
    }

    // ===============================
    // CONFIG AI (OpenRouter)
    // ===============================
    const OPENROUTER_API_KEY = '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';
    const OPENROUTER_API_URL = 'https://openrouter.ai/api/v1/chat/completions';

    async function generateCriticalQuestion(materialText) {
      try {
        const res = await fetch(OPENROUTER_API_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${OPENROUTER_API_KEY}`
          },
          body: JSON.stringify({
            model: 'openai/gpt-oss-120b',
            messages: [{ role: 'user', content: `Buatkan 3 pertanyaan kritis dari teks berikut:\n${materialText}` }],
            max_tokens: 200
          })
        });
        const json = await res.json();
        return (json.choices && json.choices.length > 0) ? json.choices[0].message.content : null;
      } catch {
        return null;
      }
    }

    // ===============================
    // RENDER KE HALAMAN
    // ===============================
    document.addEventListener('DOMContentLoaded', async () => {
      const materials = await getMaterials();
      const materi = materials.find(m => m.slug === 'jurumiya-bab1');
      const materiContent = document.getElementById('materiContent');

      if (materi) {
        materiContent.innerHTML = materi.content;
      } else {
        materiContent.innerHTML = '<p>Materi belum tersedia.</p>';
      }

      const btnGenerate = document.getElementById('btnGenerate');
      const aiOutput = document.getElementById('aiOutput');
      btnGenerate.addEventListener('click', async () => {
        if (!materi) return;
        aiOutput.innerHTML = '<p>Loading AI...</p>';
        const questions = await generateCriticalQuestion(materi.content);
        aiOutput.innerHTML = questions ? `<p>${questions}</p>` : '<p>AI gagal generate pertanyaan.</p>';
      });
    });
  </script>
</body>
</html>